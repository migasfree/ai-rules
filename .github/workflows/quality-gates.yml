name: Quality Gates

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: Lint Markdown
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Set up Node.js
        uses: actions/setup-node@012270b200b3e32c7f2bd5832381199a5c89e26e # v4.1.0
        with:
          node-version: '20'

      - name: Install Markdownlint
        run: npm install -g markdownlint-cli@0.39.0

      - name: Run Markdownlint
        run: |
          markdownlint "**/*.md" --ignore node_modules

      - name: Validate Skill Frontmatter
        run: |
          chmod +x scripts/validate_frontmatter.sh
          ./scripts/validate_frontmatter.sh

      - name: Validate Skills Catalog Sync
        run: |
          chmod +x scripts/sync_skills_catalog.sh
          echo "üîç Checking if skills catalog is synchronized..."
          ./scripts/sync_skills_catalog.sh
          if git diff --exit-code global_workflows/skill_generate.md; then
            echo "‚úÖ Skills catalog is up to date!"
          else
            echo "‚ùå ERROR: Skills catalog is out of sync!"
            echo ""
            echo "The catalog in global_workflows/skill_generate.md does not match the actual skills directory."
            echo "Please run: ./scripts/sync_skills_catalog.sh"
            echo ""
            git diff global_workflows/skill_generate.md
            exit 1
          fi
